// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Story {
  id            String     @id @default(uuid()) @db.Uuid
  title         String?
  prompt        String?
  mood          String?
  ageGroup      String?    @map("age_group")
  createdAt     DateTime   @default(now()) @map("created_at") @db.Timestamptz
  audioPath     String?    @map("audio_path")
  featured      Boolean    @default(false)
  summary       String?
  coverUrl      String?    @map("cover_url")
  voiceSettings Json?      @map("voice_settings")
  systemPrompt  String?    @map("system_prompt")
  status          String     @default("requested")
  requesterName   String?    @map("requester_name")
  requesterSource String?    @map("requester_source")
  requesterContact String?   @map("requester_contact")
  interests       String?
  characters      Character[]
  lines         Line[]
  plays         Play[]

  @@map("stories")
}

model Play {
  id        Int      @id @default(autoincrement())
  storyId   String   @map("story_id") @db.Uuid
  playedAt  DateTime @default(now()) @map("played_at") @db.Timestamptz
  userAgent String?  @map("user_agent")
  ip        String?
  story     Story    @relation(fields: [storyId], references: [id], onDelete: Cascade)

  @@index([storyId])
  @@map("plays")
}

model Character {
  id      Int     @id @default(autoincrement())
  storyId String  @map("story_id") @db.Uuid
  name    String?
  gender  String?
  voiceId String? @map("voice_id")
  story   Story   @relation(fields: [storyId], references: [id], onDelete: Cascade)

  @@index([storyId])
  @@map("characters")
}

model Line {
  id        Int     @id @default(autoincrement())
  storyId   String  @map("story_id") @db.Uuid
  sceneIdx  Int?    @map("scene_idx")
  lineIdx   Int?    @map("line_idx")
  speaker   String?
  text      String?
  sfx       String?
  audioPath String? @map("audio_path")
  story     Story   @relation(fields: [storyId], references: [id], onDelete: Cascade)

  @@index([storyId])
  @@map("lines")
}

model Waitlist {
  id             Int      @id @default(autoincrement())
  email          String
  heroName       String?  @map("hero_name")
  heroAge        String?  @map("hero_age")
  prompt         String?
  sideCharacters Json?    @map("side_characters")
  createdAt      DateTime @default(now()) @map("created_at") @db.Timestamptz
  storyId        String?  @map("story_id") @db.Uuid

  @@map("waitlist")
}